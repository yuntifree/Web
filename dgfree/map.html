<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>首页</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css">
  <link rel="stylesheet" type="text/css" href="css/map.css">
</head>
<body>
  <div class="content-nav">
    <img class="nav-logo" src="http://img.yunxingzh.com/f591c988-4b5f-49a5-8f7a-7fbc469f23a9.png">
    <ul class="nav-list g-clearfix">
      <li class="nav-list-item g-fl "><a href="javascript:;">首页</a></li>
      <li class="nav-list-item g-fl"><a href="about.html">关于我们</a></li>
      <li class="nav-list-item nav-list-cur g-fl"><a href="javascript:;">地图热点</a></li>
      <li class="nav-list-item g-fl"><a href="case.html">案例热点</a></li>
      <li class="nav-list-item g-fl"><a class="coleff" href="app.html">下载App</a></li>
    </ul>
  </div>
  <div class="content-main">
    <div class="map-main" id="allmap">
      
    </div>
  </div>
  <div class="footer">
    <dl class="footer-inner g-clearfix">
      <dt class="g-fl">
        <div class="footer-logo">
          <img src="http://img.yunxingzh.com/284355b0-0c86-4571-95e3-5c550e81ae44.png">
          <span class="footer-logo-text">— — 东莞人专属的免费上网神器</span>
        </div>
        <p class="footer-contact">服务热线：0769-21660569 广告招商：0755-86700641</p>
        <p class="footer-contact">广告招商：0755-86700641 CopyRight © 2016 粤ICP备16105742</p>
      </dt>
      <dd class="g-fr contact-code">
        <div class="g-fl wechat-code">
          <img src="http://img.yunxingzh.com/47dd71c9-0e20-4551-b0c4-7d508b372ed1.png">
          <p>官方服务公众号</p>
        </div>
        <div  class="g-fl wechat-code">
          <img src="http://img.yunxingzh.com/63954c1f-40e5-4d79-bd8c-2ce1bf3d16f6.png">
          <p>东莞无限APP</p>
        </div>
      </dd>
    </dl>
  </div>
  <script type="text/javascript" src="js/jquery.min.js"></script> 
  <script type="text/javascript" src="js/cgi.js"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/getscript?v=2.0&ak=BiR1G4yZybhnXDTDHLYq8WXMPaK7owWm"></script>
  <script type="text/javascript">
  var apAddress = [];
  // 百度地图API功能
  var map = new BMap.Map("allmap");    // 创建Map实例
  /*map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
  map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
  map.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的*/
  //map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
  var longitude = 0.0;
  var latitude = 0.0;
  var apSet;
  mapShow();
  function mapShow() {
    apSet = new Set();

      longitude = 113.90387023396529;
      latitude = 22.93310386339828;
      point = new BMap.Point(longitude, latitude);
      //标注
      /*map.centerAndZoom(point,15);
      var myIcon = new BMap.Icon("./static/target.png", new BMap.Size(60,60));
      var marker = new BMap.Marker(point,{icon:myIcon});  // 创建标注
      map.addOverlay(marker)*/
      //控件
      map.addControl(new BMap.NavigationControl());
      map.addControl(new BMap.OverviewMapControl());

      getApAddress(longitude, latitude);

    }
      function  getApAddress(){
         var param = {
          uid:137,
          token:'6ba9ac5a422d4473b337d57376dd3488'
        }
        CGI.post('get_all_aps',param,(resp)=>{
          if (resp.errno === 0) {
            addlonglat(resp.data.infos);
          }
        })
      }
      //获取覆盖物位置
      function attribute(e){
        var p = e.target;
        var adsL = apAddress[p.selIdx];
        var pointB = new BMap.Point(adsL.longitude,adsL.latitude);
        var distance  = map.getDistance(point, pointB).toFixed(2);
        //_this.tipBox('位置:'+adsL.address,distance);
      };

      function addlonglat(infos) {
        var key;
        infos.forEach((item)=>{
          key = item.longitude + ',' + item.latitude;
          if (!apSet.has(key)) {
            apSet.add(key);
            apAddress.push(item);
            addMarker(item.longitude, item.latitude, apAddress.length - 1);
          }
        })
      };

      function addMarker(lng,lat,idx) {
        //alert(lng+','+lat+','+idx);
        var spot = new BMap.Point(lng, lat);
        var myIcon2 = new BMap.Icon("./images/marker.png", new BMap.Size(31,50));
        var marker2 = new BMap.Marker(spot,{icon:myIcon2});
        map.addOverlay(marker2);
        marker2.addEventListener("click",attribute);
        marker2.selIdx = idx;
      }
</script>
</body>
</html>
